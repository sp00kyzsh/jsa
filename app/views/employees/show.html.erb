<div class="container mt-4">
  <h1 class="mb-3 text-center">Employee Profile</h1>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title border-bottom pb-2">Employee Information</h5>
      <p><strong>Name:</strong> <%= @employee.first_name %> <%= @employee.last_name %></p>
      <p><strong>Hiring Date:</strong> <%= @employee.hiring_date %></p>
      <p><strong>Job Title:</strong> <%= @employee.job_title %></p>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title border-bottom pb-2">Employment Details</h5>
      <p><strong>Status:</strong> <%= @employee.active ? "Active" : "Inactive" %></p>
      <p><strong>Employment Type:</strong> <%= @employee.employment_status %></p>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title border-bottom pb-2">Notes</h5>
      <p><%= @employee.notes.presence || "No notes available." %></p>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title border-bottom pb-2">Work History</h5>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Date</th>
            <th>Clock In</th>
            <th>Clock Out</th>
            <th>Duration (Hours)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @employee.employee_time_logs.each do |log| %>
          <tr>
            <td><%= log.clock_in.strftime("%Y-%m-%d") %></td>
            <td><%= log.clock_in.strftime("%I:%M %p") %></td>
            <td><%= log.clock_out.present? ? log.clock_out.strftime("%I:%M %p") : 'Still Clocked In' %></td>
            <td>
              <% if log.clock_out.present? %>
              <%= ((log.clock_out - log.clock_in) / 3600.0).round(2) %> hrs
              <% else %>
              N/A
              <% end %>
            </td>
            <td><%= link_to "Edit", edit_employee_employee_time_log_path(@employee, log), class: "btn btn-sm btn-warning" %></td>
          </tr>
          <% end %>
        </tbody>
      </table>

    </div>
  </div>


  <div class="container mt-4">
    <h1 class="text-center"><%= @employee.first_name %> <%= @employee.last_name %></h1>

    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title border-bottom pb-2">Work History Overview</h5>

        <p><strong>Total Hours Worked:</strong> <%= @total_hours %> hours</p>
        <p><strong>YTD Hours Worked:</strong> <%= @ytd_hours %> hours</p>

        <hr>

        <h5 class="mt-3">Filter Hours by Date Range</h5>
        <%= form_with url: employee_path(@employee), method: :get, data: { turbo_frame: "filtered_hours" }, local: false do %>
        <div class="row g-3">
          <div class="col-md-5">
            <%= label_tag :start_date, "Start Date" %>
            <%= date_field_tag :start_date, params[:start_date], class: "form-control" %>
          </div>
          <div class="col-md-5">
            <%= label_tag :end_date, "End Date" %>
            <%= date_field_tag :end_date, params[:end_date], class: "form-control" %>
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <%= submit_tag "Filter", class: "btn btn-primary" %>
          </div>
        </div>
        <% end %>

        <turbo-frame id="filtered_hours">
          <% if @filtered_hours.present? %>
          <p class="mt-3"><strong>Hours Worked in Selected Date Range:</strong> <%= @filtered_hours %> hours</p>
          <% end %>
        </turbo-frame>

      </div>
    </div>
  </div>



  <div class="d-flex justify-content-between">
    <%= link_to "Edit", edit_employee_path(@employee), class: "btn btn-warning" %>
    <%= link_to "Back", employees_path, class: "btn btn-secondary" %>
    <%= button_to "Delete", @employee, method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger" %>
  </div>
</div>



